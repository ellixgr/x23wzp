<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DBZ ULTRA MOBILE</title>
    <style>
        * { box-sizing: border-box; -webkit-touch-callout: none; -webkit-user-select: none; touch-action: none; }
        body { margin: 0; background: #000; overflow: hidden; font-family: 'Arial Black', sans-serif; }
        canvas { display: block; }
        .overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); display: flex; flex-direction: column;
            align-items: center; justify-content: center; z-index: 100;
        }
        .hud { position: fixed; top: 10px; left: 10px; color: white; width: 180px; pointer-events: none; }
        .bar { width: 100%; height: 12px; background: #333; border: 1px solid #fff; margin: 4px 0; overflow: hidden; }
        .bar-f { height: 100%; width: 0%; transition: width 0.1s; }
        .ctrl { position: fixed; bottom: 30px; width: 100%; display: flex; justify-content: space-between; padding: 0 25px; }
        .joy { width: 130px; height: 130px; background: rgba(255,255,255,0.1); border: 2px solid #555; border-radius: 50%; position: relative; pointer-events: auto; }
        #stk { width: 60px; height: 60px; background: #fff; border-radius: 50%; position: absolute; top: 35px; left: 35px; box-shadow: 0 0 15px rgba(255,255,255,0.5); }
        .btns { display: flex; gap: 15px; pointer-events: auto; align-items: flex-end; }
        .b { width: 85px; height: 85px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #fff; font-size: 16px; font-weight: bold; text-shadow: 1px 1px #000; border: 4px solid rgba(255,255,255,0.4); }
    </style>
</head>
<body>

    <div id="m" class="overlay">
        <h1 style="color: #f90; font-size: 40px; margin-bottom: 20px;">DBZ MOBILE</h1>
        <button onclick="st('Goku')" style="background:#f60; padding:20px 50px; color:#fff; border:none; border-radius:15px; font-size:20px; font-weight:bold; margin:10px;">GOKU</button>
        <button onclick="st('Vegeta')" style="background:#04f; padding:20px 50px; color:#fff; border:none; border-radius:15px; font-size:20px; font-weight:bold; margin:10px;">VEGETA</button>
    </div>

    <div class="hud">
        <div style="font-size: 12px; color: #f00;">VIDA</div>
        <div class="bar"><div id="h" class="bar-f" style="background:#f00; width:100%"></div></div>
        <div style="font-size: 12px; color: #09f;">KI (ESPECIAL)</div>
        <div class="bar"><div id="k" class="bar-f" style="background:#09f; width:0%"></div></div>
        <div style="color: #fff; font-size: 18px; margin-top: 5px;">KILLS: <span id="s">0</span></div>
    </div>

    <canvas id="c"></canvas>

    <div class="ctrl">
        <div class="joy" id="ja"><div id="stk"></div></div>
        <div class="btns">
            <div class="b" id="ba" style="background:linear-gradient(#f22, #600);">SOCO</div>
            <div class="b" id="bs" style="background:linear-gradient(#08e, #003);">PODER</div>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('c');
        const ctx = canvas.getContext('2d');
        let active = false, score = 0;
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const p = { x: canvas.width/2, y: canvas.height/2, hp: 100, ki: 0, dx: 0, dy: 0, f: 1, atk: false, sp: false, name: '' };
        const enemies = [];

        function st(n) { p.name = n; document.getElementById('m').style.display = 'none'; active = true; loop(); }

        const ja = document.getElementById('ja');
        ja.ontouchmove = (e) => {
            const t = e.touches[0];
            const r = ja.getBoundingClientRect();
            let dx = t.clientX - (r.left + 65), dy = t.clientY - (r.top + 65);
            const d = Math.sqrt(dx*dx + dy*dy);
            if(d > 50) { dx *= 50/d; dy *= 50/d; }
            document.getElementById('stk').style.transform = `translate(${dx}px, ${dy}px)`;
            p.dx = dx/4; p.dy = dy/4;
            if(dx > 5) p.f = 1; if(dx < -5) p.f = -1;
        };
        ja.ontouchend = () => { p.dx = p.dy = 0; document.getElementById('stk').style.transform = 'translate(0,0)'; };

        document.getElementById('ba').ontouchstart = (e) => { e.preventDefault(); p.atk = true; setTimeout(() => p.atk = false, 150); };
        document.getElementById('bs').ontouchstart = (e) => { 
            e.preventDefault();
            if(p.ki >= 100) { p.sp = true; p.ki = 0; setTimeout(() => p.sp = false, 1000); }
        };

        function drawChar(x, y, color, hair, isEn, hp) {
            ctx.save();
            ctx.translate(x, y);
            if(!isEn && p.f === -1) ctx.scale(-1, 1);

            // Cabelo espetado
            ctx.fillStyle = hair;
            ctx.beginPath(); ctx.moveTo(-20, -30); ctx.lineTo(-10, -55); ctx.lineTo(0, -35); ctx.lineTo(10, -55); ctx.lineTo(20, -30); ctx.fill();
            // Rosto e corpo
            ctx.fillStyle = "#ffdbac"; ctx.fillRect(-15, -35, 30, 25);
            ctx.fillStyle = color; ctx.fillRect(-18, -10, 36, 45);
            // Olhos bravos
            ctx.fillStyle = "white"; ctx.fillRect(5, -28, 8, 4); ctx.fillStyle = "black"; ctx.fillRect(8, -27, 3, 3);

            if(isEn) {
                ctx.scale(-1, 1);
                ctx.fillStyle = "red"; ctx.fillRect(-20, -65, 40, 6);
                ctx.fillStyle = "#0f0"; ctx.fillRect(-20, -65, (hp/30)*40, 6);
            }
            ctx.restore();
        }

        function update() {
            if(!active) return;
            p.x = Math.max(30, Math.min(canvas.width-30, p.x + p.dx));
            p.y = Math.max(30, Math.min(canvas.height-30, p.y + p.dy));

            enemies.forEach((en, i) => {
                const dx = p.x - en.x, dy = p.y - en.y;
                const d = Math.sqrt(dx*dx + dy*dy);
                en.x += (dx/d) * en.s; en.y += (dy/d) * en.s;

                // DANO DO SOCO
                if(p.atk && Math.abs(dy) < 40) {
                    const inRange = p.f === 1 ? (en.x > p.x && en.x < p.x + 80) : (en.x < p.x && en.x > p.x - 80);
                    if(inRange) { en.hp -= 5; en.x += p.f * 15; }
                }

                // KAMEHAMEHA REAL (Dano contínuo enquanto o raio encosta)
                if(p.sp && Math.abs(dy) < 50) {
                    const inBeam = p.f === 1 ? (en.x > p.x) : (en.x < p.x);
                    if(inBeam) { en.hp -= 1.5; en.s = 0.2; } // Desacelera no raio
                }

                if(d < 30) p.hp -= 0.4;
                if(en.hp <= 0) { enemies.splice(i, 1); score++; p.ki = Math.min(100, p.ki + 20); }
            });

            if(Math.random() < 0.03) enemies.push({x: Math.random()*canvas.width, y: Math.random()>0.5? -50 : canvas.height+50, hp: 30, s: 1.5 + (score/20)});
            
            document.getElementById('h').style.width = p.hp + "%";
            document.getElementById('k').style.width = p.ki + "%";
            document.getElementById('s').innerText = score;
            if(p.hp <= 0) { alert("PERDEU! KILLS: " + score); location.reload(); }
        }

        function loop() {
            ctx.fillStyle = "#111"; ctx.fillRect(0,0,canvas.width,canvas.height);
            
            // Grid de fundo para percepção de movimento
            ctx.strokeStyle = "#222";
            for(let i=0; i<canvas.width; i+=60) { ctx.beginPath(); ctx.moveTo(i,0); ctx.lineTo(i,canvas.height); ctx.stroke(); }

            enemies.forEach(en => drawChar(en.x, en.y, '#262', '#131', true, en.hp));
            drawChar(p.x, p.y, p.name=='Goku'?'#f60':'#04f', 'black', false);

            if(p.sp) {
                // Brilho do Especial
                let grad = ctx.createLinearGradient(p.x, p.y, p.f === 1 ? canvas.width : 0, p.y);
                grad.addColorStop(0, "white");
                grad.addColorStop(0.2, "#09f");
                grad.addColorStop(1, "rgba(0,150,255,0)");
                ctx.fillStyle = grad;
                if(p.f === 1) ctx.fillRect(p.x + 20, p.y - 25, canvas.width, 50);
                else ctx.fillRect(0, p.y - 25, p.x - 20, 50);
                
                // Texto do Golpe
                ctx.fillStyle = "white"; ctx.font = "bold 25px Arial";
                ctx.fillText(p.name=='Goku'?'KAMEHAMEHA!':'FINAL FLASH!', p.x - 50, p.y - 70);
            }

            if(p.atk) {
                ctx.fillStyle = "rgba(255,255,255,0.8)";
                ctx.beginPath(); ctx.arc(p.x + (p.f*40), p.y, 20, 0, Math.PI*2); ctx.fill();
            }

            update();
            requestAnimationFrame(loop);
        }
    </script>
</body>
</html>
